<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FactLens 明鉴AI - 四维分析</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root{--primary-color:#1a1d29;--secondary-color:#6b7280;--accent-color:#3b82f6;--fact-color:#1e40af;--opinion-color:#059669;--bias-color:#dc2626;--bg-color:#ffffff;--text-color:#111827}
    body{font-family:'Noto Sans SC',sans-serif;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);min-height:100vh}
    .hero-title{font-family:'Noto Serif SC',serif;font-weight:700;background:linear-gradient(135deg,var(--accent-color),#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .analysis-card{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);box-shadow:0 8px 32px rgba(0,0,0,.1)}
    .url-input{@apply w-full px-4 py-3 pr-12 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none;border:2px solid #e5e7eb;transition:all .3s ease}
    .url-input:focus{border-color:var(--accent-color);box-shadow:0 0 0 3px rgba(59,130,246,.1)}
    .analyze-btn{@apply w-full lg:w-auto px-12 py-4 text-white font-semibold rounded-lg flex items-center justify-center space-x-2 text-lg; background:linear-gradient(135deg,var(--accent-color),#8b5cf6);transition:all .3s ease}
    .analyze-btn:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(59,130,246,.3)}
    .loading-spinner{animation:spin 1s linear infinite}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    .fade-in{animation:fadeIn .5s ease-in}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .section-fact{border-left:4px solid var(--fact-color)}.section-opinion{border-left:4px solid var(--opinion-color)}.section-bias{border-left:4px solid var(--bias-color)}
    .mono-font{font-family:'JetBrains Mono',monospace}
  </style>
</head>
<body class="text-gray-900">
  <nav class="bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center"><i class="fas fa-search text-white text-sm"></i></div>
          <h1 class="text-xl font-semibold text-gray-900">FactLens 明鉴AI</h1>
        </div>
        <div class="flex space-x-6"><a href="#" class="text-gray-600 hover:text-blue-600 transition-colors">首页</a><a href="#" class="text-gray-600 hover:text-blue-600 transition-colors">关于</a><a href="#" class="text-gray-600 hover:text-blue-600 transition-colors">示例</a></div>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="text-center mb-12">
      <h1 class="hero-title text-4xl md:text-6xl font-bold mb-4">明鉴AI深度分析</h1>
      <p class="text-2xl text-gray-800 font-medium mb-4">明鉴事实，洞见观点</p>
      <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-8">输入网址，即刻获得「事实-观点-偏见」三色拆解报告</p>
    </div>

    <!-- INPUT -->
    <div class="analysis-card rounded-2xl p-8 mb-8">
      <label for="url-input" class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-link mr-2 text-blue-500"></i>输入要分析的网页URL</label>
      <div class="relative">
        <input type="url" id="url-input" placeholder="https://example.com/article" class="url-input w-full px-4 py-3 pr-12 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none">
        <button id="clear-btn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden"><i class="fas fa-times-circle"></i></button>
      </div>
      <div class="relative flex items-center justify-center my-6"><div class="w-full border-t border-gray-300"></div><div class="relative bg-white px-4"><span class="text-sm text-gray-500">或</span></div></div>

      <label for="text-input" class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-file-alt mr-2 text-green-500"></i>粘贴文本内容进行分析</label>
      <textarea id="text-input" rows="6" placeholder="在此粘贴您要分析的文本内容..." class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:outline-none resize-none"></textarea>
      <div class="flex justify-between items-center mt-2"><div class="text-xs text-gray-500">支持直接粘贴文本内容进行分析</div><button id="clear-text-btn" class="text-xs text-gray-400 hover:text-gray-600 hidden"><i class="fas fa-times mr-1"></i>清空文本</button></div>

      <div class="text-center mt-6"><button id="analyze-btn" class="analyze-btn w-full lg:w-auto px-12 py-4 text-white font-semibold rounded-lg flex items-center justify-center space-x-2 text-lg"><i class="fas fa-search"></i><span>明鉴一下</span></button></div>
      <div id="progress-section" class="hidden mt-6 p-4 bg-blue-50 rounded-lg">
        <div class="flex items-center space-x-3 mb-3"><div class="loading-spinner w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full"></div><span id="progress-text" class="text-blue-700 font-medium">正在获取网页内容...</span></div>
        <div class="w-full bg-blue-200 rounded-full h-2"><div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div></div>
      </div>
    </div>

    <!-- SUMMARY -->
    <div id="summary-banner" class="analysis-card rounded-2xl p-6 mb-6 hidden"><div class="flex items-center"><i class="fas fa-quote-left text-blue-500 mr-3"></i><span class="text-gray-700 font-medium">报告总结论：</span></div><p id="total-conclusion" class="text-gray-900 text-lg mt-2 leading-relaxed">正在生成结论…</p></div>

    <!-- 4D CARD -->
    <div id="four-dim-card" class="analysis-card rounded-2xl p-8 mb-8 hidden">
      <h2 class="text-2xl font-bold text-gray-900 mb-4"><i class="fas fa-chart-line text-blue-500 mr-2"></i>四维分析</h2>
      <div class="flex items-center justify-between mb-4"><span id="badge-level" class="px-3 py-1 rounded-full text-sm font-semibold text-white bg-gradient-to-r from-blue-500 to-purple-600">A 级</span><span id="badge-text" class="text-sm text-gray-600">高可信度</span></div>
      <div class="space-y-3 text-sm">
        <div class="flex items-center justify-between"><span>情绪中立度</span><span id="eb-score" class="mono-font text-orange-600">0</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div id="eb-bar" class="bg-orange-500 h-2 rounded-full" style="width:0%"></div></div>
        <div class="flex items-center justify-between"><span>信源透明度</span><span id="ts-score" class="mono-font">0</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div id="ts-bar" class="bg-blue-600 h-2 rounded-full" style="width:0%"></div></div>
        <div class="flex items-center justify-between"><span>事实密度</span><span id="fd-score" class="mono-font">0</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div id="fd-bar" class="bg-green-600 h-2 rounded-full" style="width:0%"></div></div>
        <div class="flex items-center justify-between"><span>一致性</span><span id="cs-score" class="mono-font">0</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div id="cs-bar" class="bg-purple-600 h-2 rounded-full" style="width:0%"></div></div>
      </div>
      <details class="mt-4"><summary class="text-sm text-gray-500 cursor-pointer hover:text-gray-700">展开雷达图</summary><div class="mt-2 h-64"><canvas id="radar-canvas"></canvas></div></details>
    </div>

    <!-- RESULTS -->
    <div id="results-section" class="hidden">
      <div class="grid lg:grid-cols-3 gap-8 mb-8">
        <div class="analysis-card rounded-2xl p-6 section-fact"><div class="flex items-center mb-4"><div class="w-3 h-3 bg-blue-600 rounded-full mr-3"></div><h3 class="text-lg font-semibold text-gray-900"><i class="fas fa-check-circle text-blue-600 mr-2"></i>哪些是事实</h3></div><div id="facts-list" class="space-y-2"><div class="text-sm text-gray-700 bg-blue-50 p-3 rounded-lg">正在分析事实内容...</div></div></div>
        <div class="analysis-card rounded-2xl p-6 section-opinion"><div class="flex items-center mb-4"><div class="w-3 h-3 bg-green-600 rounded-full mr-3"></div><h3 class="text-lg font-semibold text-gray-900"><i class="fas fa-lightbulb text-green-600 mr-2"></i>哪些是观点</h3></div><div id="opinions-list" class="space-y-2"><div class="text-sm text-gray-700 bg-green-50 p-3 rounded-lg">正在分析观点内容...</div></div></div>
        <div class="analysis-card rounded-2xl p-6 section-bias"><div class="flex items-center mb-4"><div class="w-3 h-3 bg-red-600 rounded-full mr-3"></div><h3 class="text-lg font-semibold text-gray-900"><i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>是否有偏见</h3></div>
          <div class="space-y-3">
            <div class="flex justify-between items-center"><span class="text-sm text-gray-600">情绪化词汇</span><span id="emotional-words" class="mono-font font-medium text-red-600">分析中...</span></div>
            <div class="flex justify-between items-center"><span class="text-sm text-gray-600">二元对立</span><span id="binary-opposition" class="mono-font font-medium text-red-600">分析中...</span></div>
            <div class="flex justify-between items-center"><span class="text-sm text-gray-600">动机揣测</span><span id="motivation-guessing" class="mono-font font-medium text-red-600">分析中...</span></div>
            <div class="flex justify-between items-center"><span class="text-sm text-gray-600">整体倾向</span><span id="overall-tendency" class="mono-font font-medium text-green-600">分析中...</span></div>
          </div>
        </div>
      </div>
      <div class="grid lg:grid-cols-2 gap-8">
        <div class="analysis-card rounded-2xl p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4"><i class="fas fa-edit text-purple-500 mr-2"></i>对内容发布者的建议</h3><p id="publisher-recommendation" class="text-gray-700 leading-relaxed">正在生成专业建议...</p></div>
        <div class="analysis-card rounded-2xl p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4"><i class="fas fa-comments text-green-500 mr-2"></i>公关回应建议</h3><p id="pr-recommendation" class="text-gray-700 leading-relaxed">正在生成公关建议...</p></div>
      </div>
    </div>

    <!-- SAMPLE -->
    <div id="sample-section" class="text-center mt-12">
      <button id="sample-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors"><i class="fas fa-play mr-2"></i>查看示例分析</button>
    </div>
  </main>

  <footer class="bg-gray-50 border-t border-gray-200 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-600"><p class="mb-2">© 2024 FactLens 明鉴AI. 专业内容分析工具</p><p class="text-sm">Powered by AI | Designed for Truth</p></div>
  </footer>

  <script>
    /* ===== 通用工具 ===== */
    const $ = id => document.getElementById(id);
    async function fetchText(url, maxTry = 2) {
      const mirrors = [
        u => `https://r.jina.ai/${encodeURIComponent(u)}?chunk_num=1&chunk_order=0&html=false`,
        u => `https://s.jina.ai/${encodeURIComponent(u)}`
      ];
      for (let i = 0; i < mirrors.length; i++) {
        try {
          const res = await fetch(mirrors[i](url), { signal: AbortSignal.timeout(8000) });
          if (res.ok) return await res.text();
        } catch (e) {
          if (i === mirrors.length - 1) throw e;
        }
      }
      return '';
    }
    function isValidBody(text) {
      if (!text || text.length < 20) return false;
      return !/完成验证后方可继续访问|百度安全验证|Sina Visitor System|请开启 JavaScript|访客验证|无法访问|403 Forbidden|404 Not Found|Access Denied|Please enable cookies/i.test(text);
    }
    function buildPrompt(content, title) {
      return `【角色】
你是明鉴AI——一个专门做「事实-观点-偏见」三色拆解的内容鉴定器。
输出必须严格遵循下方【格式规范】，否则下游解析器会报错。

【思考步骤】
Step-1 通读全文，用两句话以内概括原文核心信息。
Step-2 把文中所有陈述按句切分，每句先判断"是否可证伪"，再归入<fact>或<opinion>。
Step-3 对<opinion>句进一步做偏见扫描：标出情绪化词汇、二元对立、动机揣测、逻辑谬误，并给出原文片段。

【格式规范】
| 明鉴·FactLens 报告 |
|------------------|
| 标题：${title} |
| 可信度：X / 10（一句话理由）|

#### 事实区（≤8 条，每条≤40 字，必须可证伪）
1. <fact>xxx</fact>
...

#### 观点区（≤8 条，每条≤40 字，必须不可证伪）
1. <opinion>xxx</opinion>

#### 偏见指标
- 情绪化词汇：X 处；示例：<eg>原句1</eg>|<eg>原句2</eg>
- 二元对立：X 组；示例：<eg>原句</eg>
- 动机揣测：X 处；示例：<eg>原句</eg>
- 逻辑谬误：X 处；类型：<type>滑坡/稻草人/诉诸权威</type>；示例：<eg>原句</eg>
- 整体倾向：批判/中性/赞扬 X%（按句子数占比估）

#### 对内容发布者的建议（≤100 字，必须可执行，禁止写"无"）
【场景】${title}
【问题】{{用一句话指出 1 个最大风险或短板}}
【行动】{{给出 1 条最应立即执行的补救动作，用动词开头，量化优先}}
xxx

#### 公关回应建议（≤100 字，必须可执行，禁止写"无"）
【场景】${title}
【舆情风险】{{用一句话指出公众最可能误解的点}}
【回应要点】{{给出 1 条可直接发布的回应口径，含时间节点/数据/引用来源，≤100 字}}
xxx

#### 报告总结论（≤80 字）
用第三人称、两句话以内概括原文核心信息，禁止出现"作者""本文"字样。
xxx

【正文】
${content}`;
    }
    async function analyzeWithKimi(content, title) {
      const prompt = buildPrompt(content, title);
      const body = { model: 'moonshot-v1-8k', messages: [{ role: 'user', content: prompt }], temperature: 0.25, max_tokens: 2048 };
      const res = await
